"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[412],{3311:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var r=s(4848),t=s(8453);const i={sidebar_position:2},o="Class transformer",a={id:"validation/class-transformer",title:"Class transformer",description:"- Class transformer gi\xfap ta bi\u1ebfn \u0111\u1ed5i d\u1eef li\u1ec7u tr\u01b0\u1edbc khi \u0111\u01b0\u1ee3c validate b\u1edfi class validator.",source:"@site/docs/validation/class-transformer.md",sourceDirName:"validation",slug:"/validation/class-transformer",permalink:"/nestjs/validation/class-transformer",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Class validator",permalink:"/nestjs/validation/class-validator"},next:{title:"Websockets",permalink:"/nestjs/category/websockets"}},l={},c=[{value:"<code>@Type()</code>",id:"type",level:2},{value:"<code>@Transform()</code>",id:"transform",level:2},{value:"<code>@Expose()</code>",id:"expose",level:2},{value:"Custom transform decorator",id:"custom-transform-decorator",level:2}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"class-transformer",children:"Class transformer"})}),"\n",(0,r.jsx)(e.admonition,{type:"note",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Class transformer gi\xfap ta bi\u1ebfn \u0111\u1ed5i d\u1eef li\u1ec7u tr\u01b0\u1edbc khi \u0111\u01b0\u1ee3c validate b\u1edfi class validator."}),"\n"]})}),"\n",(0,r.jsx)(e.h2,{id:"type",children:(0,r.jsx)(e.code,{children:"@Type()"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Khi ta s\u1eed d\u1ee5ng ",(0,r.jsx)(e.code,{children:"@Type()"}),", ta c\xf3 th\u1ec3 x\xe1c \u0111\u1ecbnh ki\u1ec3u d\u1eef li\u1ec7u m\xe0 thu\u1ed9c t\xednh s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i. V\xed d\u1ee5, n\u1ebfu ta c\xf3 m\u1ed9t thu\u1ed9c t\xednh l\xe0 m\u1ed9t m\u1ea3ng c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng ho\u1eb7c m\u1ed9t l\u1edbp kh\xe1c, ta c\xf3 th\u1ec3 ch\u1ec9 \u0111\u1ecbnh ki\u1ec3u c\u1ee7a n\xf3 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o r\u1eb1ng qu\xe1 tr\xecnh chuy\u1ec3n \u0111\u1ed5i di\u1ec5n ra \u0111\xfang c\xe1ch."]}),"\n",(0,r.jsx)(e.li,{children:"V\xed d\u1ee5 v\u1edbi ki\u1ec3u d\u1eef li\u1ec7u nguy\xean th\u1ee7y:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:'import { Type } from "class-transformer";\nimport { IsNotEmpty, IsNumber } from "class-validator";\n\nexport class ChangeUserInformationDTO {\n  @Type(() => Number)\n  @IsNumber()\n  @IsNotEmpty()\n  userId: number;\n}\n'})}),"\n",(0,r.jsx)(e.admonition,{type:"note",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u1ede v\xed d\u1ee5 tr\xean, class transformer s\u1ebd c\u1ed1 g\u1eafng bi\u1ebfn \u0111\u1ed5i v\u1ec1 ki\u1ec3u number tr\u01b0\u1edbc khi validate. V\xed d\u1ee5, ta truy\u1ec1n ",(0,r.jsx)(e.code,{children:'"userId": "123"'})," th\xec sau khi bi\u1ebfn \u0111\u1ed5i s\u1ebd \u0111\u01b0\u1ee3c ",(0,r.jsx)(e.code,{children:'"userId": 123'}),", v\xe0 sau \u0111\xf3 validate"]}),"\n"]})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"V\xed d\u1ee5 v\u1edbi ki\u1ec3u d\u1eef li\u1ec7u l\xe0 m\u1ed9t object:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:'import { Type } from "class-transformer";\nimport { IsNotEmpty, IsString, ValidateNested, IsArray } from "class-validator";\n\nclass AddressDTO {\n  @IsString()\n  @IsNotEmpty()\n  street: string;\n\n  @IsString()\n  @IsNotEmpty()\n  city: string;\n}\n\nexport class UserDTO {\n  @IsString()\n  @IsNotEmpty()\n  name: string;\n\n  @Type(() => AddressDTO)\n  @ValidateNested({ each: true })\n  @IsArray()\n  address: AddressDTO[];\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"transform",children:(0,r.jsx)(e.code,{children:"@Transform()"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Khi ta s\u1eed d\u1ee5ng ",(0,r.jsx)(e.code,{children:"@Transform"}),", ta c\xf3 th\u1ec3 ch\u1ec9 \u0111\u1ecbnh m\u1ed9t h\xe0m nh\u1eadn \u0111\u1ea7u v\xe0o v\xe0 tr\u1ea3 v\u1ec1 gi\xe1 tr\u1ecb \u0111\xe3 \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ed5i. \u0110i\u1ec1u n\xe0y r\u1ea5t h\u1eefu \xedch khi ta mu\u1ed1n thay \u0111\u1ed5i \u0111\u1ecbnh d\u1ea1ng c\u1ee7a d\u1eef li\u1ec7u ho\u1eb7c th\u1ef1c hi\u1ec7n m\u1ed9t s\u1ed1 thao t\xe1c tr\xean d\u1eef li\u1ec7u tr\u01b0\u1edbc khi g\xe1n n\xf3 cho thu\u1ed9c t\xednh."]}),"\n",(0,r.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:'import { Transform } from "class-transformer";\nimport { IsArray, IsNotEmpty, IsString } from "class-validator";\n\nexport class UserDTO {\n  @IsString()\n  @IsNotEmpty()\n  name: string;\n\n  @Transform(({ value, obj }) =>\n    obj.name === "John" ? ["New York"] : ["Los Angeles"]\n  )\n  @IsString({ each: true })\n  @IsArray()\n  @IsNotEmpty({ each: true })\n  address: string[];\n\n  @IsString({ each: true })\n  @IsArray()\n  @IsNotEmpty({ each: true })\n  @Transform(({ value }) => value.map((v: string) => v.toUpperCase()))\n  hobbies: string[];\n}\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u1ede v\xed d\u1ee5 tr\xean, n\u1ebfu ta g\u1eedi d\u1eef li\u1ec7u:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "name": "John",\n  "address": ["string"],\n  "hobbies": ["Badminton"]\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"sau khi bi\u1ebfn \u0111\u1ed5i, s\u1ebd nh\u1eadn \u0111\u01b0\u1ee3c:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"UserDTO {\n  name: 'John',\n  address: [ 'New York' ],\n  hobbies: [ 'BADMINTON' ]\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"expose",children:(0,r.jsx)(e.code,{children:"@Expose()"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Decorator n\xe0y th\xedch h\u1ee3p s\u1eed d\u1ee5ng khi ta g\u1eedi d\u1eef li\u1ec7u response v\u1ec1 cho client. Ch\u1ec9 nh\u1eefng thu\u1ed9c t\xednh \u0111\xednh decorator n\xe0y s\u1ebd \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn client, lo\u1ea1i b\u1ecf nh\u1eefng thu\u1ed9c t\xednh d\u01b0 th\u1eeba kh\xf4ng mong mu\u1ed1n."}),"\n",(0,r.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="LoginResponse.dto.ts"',children:'import { Expose, Type } from "class-transformer";\n\nclass UserResponseDTO {\n  @Expose()\n  id: string;\n\n  @Expose()\n  fullName: string;\n\n  @Expose()\n  email: string;\n\n  @Expose()\n  avatar: string;\n\n  @Expose()\n  isEnableTwoFactorAuth: boolean;\n}\n\nexport class LoginResponseDTO {\n  @Expose()\n  @Type(() => UserResponseDTO)\n  user: UserResponseDTO;\n\n  @Expose()\n  accessToken: string;\n\n  @Expose()\n  refreshToken: string;\n\n  @Expose()\n  expiresIn: number;\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"custom-transform-decorator",children:"Custom transform decorator"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u0110\u1ec3 t\u1ea1o custom transform decorator, ta \u0111\u01a1n gi\u1ea3n t\u1ea1o m\u1ed9t h\xe0m r\u1ed3i s\u1eed d\u1ee5ng h\xe0m ",(0,r.jsx)(e.code,{children:"Transform()"})," do ",(0,r.jsx)(e.strong,{children:"class-transformer"})," cung c\u1ea5p."]}),"\n",(0,r.jsxs)(e.li,{children:["D\u01b0\u1edbi \u0111\xe2y l\xe0 2 v\xed d\u1ee5 custom transform decorator: ",(0,r.jsx)(e.strong,{children:"trim"})," v\u1edbi ",(0,r.jsx)(e.strong,{children:"to-boolean"})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="trim.transform.ts"',children:'import { Transform } from "class-transformer";\n\ninterface ITrimOptions {\n  each?: boolean;\n}\n\nexport const Trim = (options?: ITrimOptions) => {\n  return Transform(({ value }) => {\n    if (typeof value === "string") {\n      return value.trim();\n    }\n    if (Array.isArray(value) && options?.each) {\n      return value.map((item) => {\n        if (typeof item === "string") {\n          return item.trim();\n        }\n        return item;\n      });\n    }\n    return value;\n  });\n};\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="to-boolean.transform.ts"',children:'import { Transform } from "class-transformer";\n\ninterface IToBooleanOptions {\n  each?: boolean;\n}\n\nconst acceptedParseToBoolean = [true, false, "true", "false", 0, 1];\n\nexport const ToBoolean = (options?: IToBooleanOptions) => {\n  return Transform(({ value }) => {\n    if (Array.isArray(value) && options?.each) {\n      return value.map((item) => {\n        if (acceptedParseToBoolean.includes(item)) {\n          return item === "false" ? false : Boolean(item);\n        }\n        return item;\n      });\n    }\n    if (acceptedParseToBoolean.includes(value)) {\n      return value === "false" ? false : Boolean(value);\n    }\n    return value;\n  });\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Cu\u1ed1i c\xf9ng, s\u1eed d\u1ee5ng c\xe1c custom transform decorator n\xe0y:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",metastring:'title="User.dto.ts"',children:'import { IsBoolean, IsNotEmpty, IsString } from "class-validator";\n\nimport { ToBoolean } from "src/common/decorators/sanitizer/to-boolean.sanitizer";\nimport { Trim } from "src/common/decorators/sanitizer/trim.sanitizer";\n\nexport class UserDTO {\n  @Trim()\n  @IsString()\n  @IsNotEmpty()\n  name: string;\n\n  @ToBoolean()\n  @IsNotEmpty()\n  @IsBoolean()\n  isVerified: boolean;\n}\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"D\u1eef li\u1ec7u g\u1eedi l\xean:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "name": "   Nguy\u1ec5n Minh Ch\xed            ",\n  "isVerified": 1\n}\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"D\u1eef li\u1ec7u sau khi transform:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"UserDTO { name: 'Nguy\u1ec5n Minh Ch\xed', isVerified: true }\n"})})]})}function m(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>a});var r=s(6540);const t={},i=r.createContext(t);function o(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);