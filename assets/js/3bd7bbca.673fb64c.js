"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[23],{7593:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"websockets/websocket-pipe-exfilter-interceptor-guard","title":"S\u1eed d\u1ee5ng Pipe, Exception Filter, Interceptor, Guard trong WebSocket Gateway","description":"- T\u01b0\u01a1ng t\u1ef1 nh\u01b0 HTTP, \u1edf WebSocket Gateway ta c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng:","source":"@site/docs/websockets/websocket-pipe-exfilter-interceptor-guard.md","sourceDirName":"websockets","slug":"/websockets/websocket-pipe-exfilter-interceptor-guard","permalink":"/nestjs/websockets/websocket-pipe-exfilter-interceptor-guard","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"T\u1ea1o WebSocket Gateway","permalink":"/nestjs/websockets/create-websocket-gateway"},"next":{"title":"T\u1ea1o exception filter cho app","permalink":"/nestjs/custom-exception-filter"}}');var i=t(4848),r=t(8453);const c={sidebar_position:3},o="S\u1eed d\u1ee5ng Pipe, Exception Filter, Interceptor, Guard trong WebSocket Gateway",l={},a=[{value:"V\xed d\u1ee5",id:"v\xed-d\u1ee5",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"s\u1eed-d\u1ee5ng-pipe-exception-filter-interceptor-guard-trong-websocket-gateway",children:"S\u1eed d\u1ee5ng Pipe, Exception Filter, Interceptor, Guard trong WebSocket Gateway"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["T\u01b0\u01a1ng t\u1ef1 nh\u01b0 HTTP, \u1edf WebSocket Gateway ta c\u0169ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UsePipes"}),": validate d\u1eef li\u1ec7u g\u1eedi \u0111\u1ebfn t\u1eeb client."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UseFilters"}),": x\u1eed l\xfd l\u1ed7i \u0111\u01b0\u1ee3c throw ra t\u1eeb WebSocket"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UseInterceptors"}),": d\xf9ng cho c\xe1c nhi\u1ec7m v\u1ee5 nh\u01b0 ghi log,..."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UseGuards"}),": x\xe1c th\u1ef1c user tr\u01b0\u1edbc khi x\u1eed l\xfd event \u0111\u01b0\u1ee3c g\u1eedi l\xean t\u1eeb client,..."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Ta c\u0169ng c\xf3 th\u1ec3 d\xf9ng ch\xfang \u1edf 2 c\u1ea5p \u0111\u1ed9:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cho to\xe0n b\u1ed9 event"}),"\n",(0,i.jsx)(n.li,{children:"Cho t\u1eebng event c\u1ee5 th\u1ec3"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsxs)(n.admonition,{title:"L\u01b0u \xfd",type:"note",children:[(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["M\u1eb7c d\xf9 ta \u0111\xe3 c\u1ea5u h\xecnh ",(0,i.jsx)(n.code,{children:"APP_FILTER"}),", ",(0,i.jsx)(n.code,{children:"APP_PIPE"}),", ",(0,i.jsx)(n.code,{children:"APP_GUARD"}),", ",(0,i.jsx)(n.code,{children:"APP_INTERCEPTOR"})," \u1edf file ",(0,i.jsx)(n.strong,{children:"app.module.ts"}),", nh\u01b0ng m\xecnh kh\xf4ng hi\u1ec3u l\xfd do g\xec n\xf3 ch\u1ec9 \u0111ang ho\u1ea1t \u0111\u1ed9ng \u0111\u1ed1i v\u1edbi HTTP, c\xf2n ",(0,i.jsx)(n.strong,{children:"WebSocket th\xec ph\u1ea3i ch\u1ec9 \u0111\u1ecbnh l\u1ea1i to\xe0n b\u1ed9 \u1edf \u0111\u1ea7u Gateway"})," (m\u1ee5c v\xed d\u1ee5 d\u01b0\u1edbi):"]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"@Module({\n  providers: [\n    { provide: APP_FILTER, useClass: AllExceptionsFilter },\n    { provide: APP_FILTER, useClass: HttpExceptionFilter },\n    { provide: APP_FILTER, useClass: WsExceptionFilter },\n    { provide: APP_PIPE, useClass: AppValidationPipe },\n    { provide: APP_GUARD, useClass: AuthGuard },\n    { provide: APP_INTERCEPTOR, useClass: AppClassSerializerInterceptor },\n    { provide: APP_INTERCEPTOR, useClass: LoggingInterceptor },\n  ],\n})\nexport class AppModule {}\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"v\xed-d\u1ee5",children:"V\xed d\u1ee5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'@WebSocketGateway({ namespace: "/chat", cors: { origin: "*" } })\n@UseFilters(AllExceptionsFilter, WsExceptionFilter)\n@UseInterceptors(LoggingInterceptor)\n@UseGuards(AuthGuard)\n@UsePipes(\n  new ValidationPipe({\n    exceptionFactory: (errors) =>\n      new WsException({ message: "Invalid message data", errors }),\n  })\n)\nexport class ChatGateway\n  implements OnGatewayInit, OnGatewayConnection, OnGatewayDisconnect\n{\n  @WebSocketServer() server: Server;\n  private readonly logger = new Logger(ChatGateway.name);\n\n  afterInit(server: Server) {\n    this.logger.log("\ud83d\ude80 ChatGateway was established succesfully!");\n  }\n\n  handleConnection(client: Socket) {\n    console.log(`Client connected: ${client.id}`);\n  }\n\n  handleDisconnect(client: Socket) {\n    console.log(`Client disconnected: ${client.id}`);\n  }\n\n  @SubscribeMessage("sendMessage")\n  handleMessage(\n    client: Socket,\n    payload: { sender: string; message: string }\n  ): WsResponse<string> {\n    this.server.emit("receiveMessage", data);\n    return {\n      event: "toClientEvent",\n      data: "Done",\n    };\n  }\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u1ede v\xed d\u1ee5 tr\xean, ta s\u1eed d\u1ee5ng:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UseFilters(AllExceptionsFilter, WsExceptionFilter)"}),": Xem ",(0,i.jsx)(n.a,{href:"../custom-exception-filter",children:"t\u1ea1i \u0111\xe2y"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@UseInterceptors(LoggingInterceptor)"}),": Xem ",(0,i.jsx)(n.a,{href:"../custom-app-logging",children:"t\u1ea1i \u0111\xe2y"})]}),"\n"]}),"\n"]}),"\n"]})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var s=t(6540);const i={},r=s.createContext(i);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);