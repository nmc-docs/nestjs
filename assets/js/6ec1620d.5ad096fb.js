"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[112],{8749:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var t=s(4848),i=s(8453);const o={sidebar_position:99},r="Note v\u1ec1 NestJS",c={id:"nestjs-note",title:"Note v\u1ec1 NestJS",description:"1",source:"@site/docs/nestjs-note.md",sourceDirName:".",slug:"/nestjs-note",permalink:"/nestjs/nestjs-note",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:99,frontMatter:{sidebar_position:99},sidebar:"tutorialSidebar",previous:{title:"Nestjs Swagger",permalink:"/nestjs/nestjs-swagger"}},d={},l=[{value:"1",id:"1",level:2},{value:"2",id:"2",level:2},{value:"3",id:"3",level:2},{value:"4",id:"4",level:2},{value:"5",id:"5",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"note-v\u1ec1-nestjs",children:"Note v\u1ec1 NestJS"})}),"\n",(0,t.jsx)(n.h2,{id:"1",children:"1"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Trong NestJS, decorator ",(0,t.jsx)(n.code,{children:"@Injectable()"})," \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 \u0111\xe1nh d\u1ea5u m\u1ed9t l\u1edbp l\xe0 m\u1ed9t provider. C\xe1c provider trong NestJS l\xe0 c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng m\xe0 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c NestJS qu\u1ea3n l\xfd v\xe0 inject (ti\xeam) v\xe0o c\xe1c ph\u1ea7n kh\xe1c c\u1ee7a \u1ee9ng d\u1ee5ng (nh\u01b0 controller ho\u1eb7c c\xe1c provider kh\xe1c) th\xf4ng qua c\u01a1 ch\u1ebf dependency injection."]}),"\n",(0,t.jsxs)(n.li,{children:["T\u1ea1i sao c\u1ea7n s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"@Injectable()"}),"?\nDependency Injection: ",(0,t.jsx)(n.code,{children:"@Injectable()"})," gi\xfap NestJS bi\u1ebft r\u1eb1ng l\u1edbp n\xe0y c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c ti\xeam v\xe0o c\xe1c l\u1edbp kh\xe1c. \u0110i\u1ec1u n\xe0y gi\xfap qu\u1ea3n l\xfd s\u1ef1 ph\u1ee5 thu\u1ed9c gi\u1eefa c\xe1c l\u1edbp d\u1ec5 d\xe0ng h\u01a1n v\xe0 th\xfac \u0111\u1ea9y vi\u1ec7c s\u1eed d\u1ee5ng l\u1ea1i m\xe3 ngu\u1ed3n.\nQu\u1ea3n l\xfd lifecycle: NestJS qu\u1ea3n l\xfd v\xf2ng \u0111\u1eddi c\u1ee7a c\xe1c provider v\xe0 \u0111\u1ea3m b\u1ea3o r\u1eb1ng ch\xfang \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o v\xe0 h\u1ee7y \u0111\xfang c\xe1ch."]}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"2",children:"2"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Khi t\u1ea1o m\u1ed9t service m\xe0 \u0111\u01b0\u1ee3c qu\u1ea3n l\xfd b\u1edfi Dependency Injection Container (\u0111\u01b0\u1ee3c \u0111\xe1nh d\u1ea5u b\u1edfi ",(0,t.jsx)(n.code,{children:"@Injectable()"}),"), ngo\u1ea1i tr\u1eeb c\xe1c ",(0,t.jsx)(n.a,{href:"./nestjs-fundamentals/guards",children:"Guard"}),", ",(0,t.jsx)(n.a,{href:"./nestjs-fundamentals/exception-filters",children:"Exception filter"}),", ",(0,t.jsx)(n.a,{href:"./nestjs-fundamentals/pipes",children:"Pipe"}),", ",(0,t.jsx)(n.a,{href:"./nestjs-fundamentals/interceptors",children:"Interceptor"}),", ",(0,t.jsx)(n.a,{href:"./nestjs-fundamentals/middleware",children:"Middleware"})," th\xec n\xean cho ch\xfang v\xe0o m\u1ed9t module. Khi s\u1eed d\u1ee5ng c\xe1c service n\xe0y th\xec import module \u0111\xf3 v\xe0o."]}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"3",children:"3"}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"\u274cKH\xd4NG N\xcaN VI\u1ebeT KI\u1ec2U N\xc0Y:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\nimport { Redis } from "ioredis";\n\n@Injectable()\nexport class RedisService {\n  private redis: Redis;\n\n  constructor() {\n    this.redis = new Redis();\n  }\n}\n'})}),(0,t.jsx)(n.p,{children:"\u2705N\xcaN VI\u1ebeT NH\u01af N\xc0Y: t\u1ea1o th\xe0nh m\u1ed9t service m\u1edbi \u0111\u1ec3 d\u1ec5 qu\u1ea3n l\xfd, sau \u0111\xf3 b\u1ecf h\u1ebft v\xe0o m\u1ed9t module."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Inject, Injectable, Logger, OnModuleInit } from "@nestjs/common";\nimport { Redis, RedisOptions } from "ioredis";\n\nimport { EProviderKey } from "src/common/constants/provider-key.constant";\n\n@Injectable()\nexport class RedisProvider extends Redis {\n  //Ta \u0111\u01b0\u1ee3c vi\u1ebft nh\u01b0 n\xe0y b\u1edfi v\xec logger n\xe0y l\xe0 m\u1ed9t constant v\xe0 ch\u1ec9 \xe1p d\u1ee5ng cho ri\xeang service RedisProvider\n  private readonly logger = new Logger(RedisProvider.name);\n\n  constructor(@Inject(EProviderKey.REDIS_OPTIONS) options: RedisOptions) {\n    super(options);\n  }\n\n  async onModuleInit() {\n    try {\n      const redisInfo = await this.info();\n      await this.config("SET", "notify-keyspace-events", "KEA");\n      this.logger.log("\ud83d\ude80 Connect to Redis successfully!");\n    } catch (error) {\n      this.disconnect();\n      throw new Error(\n        `\u274c Connect to Redis failed: ${(error as Error).message}`\n      );\n    }\n  }\n}\n'})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\nimport { Redis } from "ioredis";\n\n@Injectable()\nexport class RedisService {\n  constructor(private redis: RedisProvider) {}\n}\n'})})]}),"\n",(0,t.jsx)(n.h2,{id:"4",children:"4"}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\n\n@Injectable()\nexport class ExampleService {\n  private property1;\n  private property2;\n  private constants1 = "EXAMPLE VALUE";\n\n  constructor(\n    private serviceA: ServiceA,\n    private serviceB: ServiceB,\n    private serviceC: ServiceC\n  ) {\n    property1 = X;\n    property2 = Y;\n  }\n}\n'})}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["C\xe1c tham s\u1ed1 truy\u1ec1n v\xe0o ",(0,t.jsx)(n.code,{children:"constructor()"})," ph\u1ea3i l\xe0 c\xe1c ",(0,t.jsx)(n.strong,{children:"PROVIDER"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["C\xe1c thu\u1ed9c t\xednh kh\xe1c c\u1ee7a class kh\xf4ng ph\u1ea3i l\xe0 ",(0,t.jsx)(n.strong,{children:"PROVIDER"})," th\xec khai b\xe1o ra ngo\xe0i, khi kh\u1edfi t\u1ea1o th\xec th\u1ef1c hi\u1ec7n b\xean trong h\xe0m ",(0,t.jsx)(n.code,{children:"constructor()"})]}),"\n",(0,t.jsx)(n.li,{children:"C\xe1c thu\u1ed9c t\xednh l\xe0 h\u1eb1ng s\u1ed1 th\xec khai b\xe1o v\xe0 g\xe1n lu\xf4n gi\xe1 tr\u1ecb."}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"5",children:"5"}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Khi s\u1eed d\u1ee5ng c\xe1c class c\u1ee7a th\u01b0 vi\u1ec7n, ta n\xean t\u1ea1o provider ri\xeang v\xe0 ",(0,t.jsx)(n.code,{children:"extends"})," t\u1eeb class c\u1ee7a th\u01b0 vi\u1ec7n \u0111\xf3."]}),"\n",(0,t.jsxs)(n.li,{children:["N\u1ebfu class c\u1ee7a th\u01b0 vi\u1ec7n c\xf3 tham s\u1ed1 kh\u1edfi t\u1ea1o th\xec ta n\xean t\u1ea1o dynamic module, t\u1ea1o c\xe1c h\xe0m static nh\u01b0 ",(0,t.jsx)(n.code,{children:"forRoot"}),", ",(0,t.jsx)(n.code,{children:"register"}),",... \u0111\u1ec3 nh\u1eadn c\u1ea5u h\xecnh. Sau \u0111\xf3, t\u1ea1o th\xeam provider s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"useValue"})," ho\u1eb7c ",(0,t.jsx)(n.code,{children:"useFactory"})," \u0111\u1ec3 nh\u1eadn gi\xe1 tr\u1ecb c\u1ea5u h\xecnh n\xe0y. Vi\u1ec7c c\xf2n l\u1ea1i l\xe0 t\u1eeb class extends kia, ta inject provider ch\u1ee9a tham s\u1ed1 c\u1ea5u h\xecnh v\xe0o v\xe0 s\u1eed d\u1ee5ng ",(0,t.jsx)(n.code,{children:"super()"})," \u0111\u1ec3 kh\u1edfi t\u1ea1o."]}),"\n"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { RedisOptions } from "ioredis";\n\nexport interface IRedisModuleAsyncOptions {\n  imports?: any[];\n  useFactory?: (...args: any[]) => Promise<RedisOptions> | RedisOptions;\n  inject?: any[];\n  isGlobal?: boolean;\n}\n\nexport interface IRedisModuleOptions extends RedisOptions {\n  isGlobal?: boolean;\n}\n'})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"@Module({})\nexport class RedisModule {\n  static forRootAsync(options: IRedisModuleAsyncOptions): DynamicModule {\n    const defaultFactory = (...args: any[]) => null;\n    return {\n      module: RedisModule,\n      imports: options.imports || [],\n      providers: [\n        RedisProvider,\n        RedisService,\n        {\n          provide: EProviderKey.REDIS_OPTIONS,\n          useFactory: options.useFactory || defaultFactory,\n          inject: options.inject || [],\n        },\n      ],\n      exports: [RedisService],\n      global: options.isGlobal ?? false,\n    };\n  }\n\n  static forRoot(options: IRedisModuleOptions): DynamicModule {\n    return {\n      module: RedisModule,\n      providers: [\n        RedisProvider,\n        RedisService,\n        { provide: EProviderKey.REDIS_OPTIONS, useValue: options },\n      ],\n      exports: [RedisService],\n      global: options.isGlobal ?? false,\n    };\n  }\n}\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"@Injectable()\nexport class RedisProvider extends Redis {\n  constructor(@Inject(EProviderKey.REDIS_OPTIONS) options: RedisOptions) {\n    super(options);\n  }\n}\n"})})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var t=s(6540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);