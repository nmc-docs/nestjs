"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[570],{8148:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"websockets/create-websocket-gateway","title":"T\u1ea1o WebSocket Gateway","description":"- Nh\u01b0 \u1edf m\u1ee5c tr\u01b0\u1edbc ta \u0111\xe3 \u0111\u1ec1 c\u1eadp, m\u1ed7i WebSocket Gateway s\u1ebd \u1ee9ng v\u1edbi m\u1ed9t namespace ri\xeang bi\u1ec7t, gi\xfap ta t\u1ed5 ch\u1ee9c, qu\u1ea3n l\xfd ch\xfang \u0111\u01b0\u1ee3c tinh g\u1ecdn h\u01a1n. D\u01b0\u1edbi \u0111\xe2y l\xe0 c\xe1ch t\u1ea1o m\u1ed9t Chat Gateway (namespace l\xe0: /chat)","source":"@site/docs/websockets/create-websocket-gateway.md","sourceDirName":"websockets","slug":"/websockets/create-websocket-gateway","permalink":"/nestjs/websockets/create-websocket-gateway","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Gi\u1edbi thi\u1ec7u v\u1ec1 Websockets","permalink":"/nestjs/websockets/introduce"},"next":{"title":"S\u1eed d\u1ee5ng Pipe, Exception Filter, Interceptor, Guard trong WebSocket Gateway","permalink":"/nestjs/websockets/websocket-pipe-exfilter-interceptor-guard"}}');var c=s(4848),i=s(8453);const r={sidebar_position:2},l="T\u1ea1o WebSocket Gateway",d={},o=[{value:"<code>WsResponse&lt;T&gt;</code>",id:"wsresponset",level:2},{value:"S\u1ef1 kh\xe1c bi\u1ec7t gi\u1eefa <code>this.server.emit(...)</code> , <code>this.server.to().emit()</code> v\xe0 <code>client.emit(...)</code>",id:"s\u1ef1-kh\xe1c-bi\u1ec7t-gi\u1eefa-thisserveremit--thisservertoemit-v\xe0-clientemit",level:2}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"t\u1ea1o-websocket-gateway",children:"T\u1ea1o WebSocket Gateway"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Nh\u01b0 \u1edf m\u1ee5c tr\u01b0\u1edbc ta \u0111\xe3 \u0111\u1ec1 c\u1eadp, m\u1ed7i ",(0,c.jsx)(n.strong,{children:"WebSocket Gateway s\u1ebd \u1ee9ng v\u1edbi m\u1ed9t namespace ri\xeang bi\u1ec7t"}),", gi\xfap ta t\u1ed5 ch\u1ee9c, qu\u1ea3n l\xfd ch\xfang \u0111\u01b0\u1ee3c tinh g\u1ecdn h\u01a1n. D\u01b0\u1edbi \u0111\xe2y l\xe0 c\xe1ch t\u1ea1o m\u1ed9t ",(0,c.jsx)(n.strong,{children:"Chat Gateway"})," (namespace l\xe0: ",(0,c.jsx)(n.code,{children:"/chat"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:["T\u1ea1o file ",(0,c.jsx)(n.strong,{children:"chat.gateway.ts"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ts",children:'import { Logger } from "@nestjs/common";\nimport {\n  WebSocketGateway,\n  WebSocketServer,\n  WsResponse,\n  SubscribeMessage,\n  OnGatewayInit,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n} from "@nestjs/websockets";\nimport { Server, Socket } from "socket.io";\n\n@WebSocketGateway({ namespace: "/chat", cors: { origin: "*" } })\nexport class ChatGateway\n  implements OnGatewayInit, OnGatewayConnection, OnGatewayDisconnect\n{\n  @WebSocketServer() server: Server;\n  private readonly logger = new Logger(ChatGateway.name);\n\n  afterInit(server: Server) {\n    this.logger.log("\ud83d\ude80 ChatGateway was established succesfully!");\n  }\n\n  handleConnection(client: Socket) {\n    console.log(`Client connected: ${client.id}`);\n  }\n\n  handleDisconnect(client: Socket) {\n    console.log(`Client disconnected: ${client.id}`);\n  }\n\n  @SubscribeMessage("sendMessage")\n  handleMessage(\n    client: Socket,\n    payload: { sender: string; message: string }\n  ): WsResponse<string> {\n    // this.server.emit("receiveMessage", payload);\n    // client.emit("receiveMessage", payload)\n    return {\n      event: "toClientEvent",\n      data: "Done",\n    };\n  }\n}\n'})}),"\n",(0,c.jsx)(n.admonition,{title:"C\xe1c Lifecycle Hooks",type:"info",children:(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u1ede v\xed d\u1ee5 tr\xean, ta th\u1ea5y 3 lifecycle hooks:","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"afterInit(server: Server)"})," - G\u1ecdi sau khi WebSocket server kh\u1edfi t\u1ea1o."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"handleConnection(client: Socket)"})," - Khi client k\u1ebft n\u1ed1i."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"handleDisconnect(client: Socket)"})," - Khi client ng\u1eaft k\u1ebft n\u1ed1i."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,c.jsx)(n.admonition,{title:"Decorators",type:"info",children:(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"@WebSocketGateway(port?: number, options?: GatewayOptions)"})," \u2013 \u0111\xe1nh d\u1ea5u class l\xe0 gateway."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"@WebSocketServer()"})," \u2013 l\u1ea5y \u0111\u1ed1i t\u01b0\u1ee3ng server g\u1ed1c (socket.io ho\u1eb7c ws)."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"@SubscribeMessage(event: string)"})," \u2013 l\u1eafng nghe s\u1ef1 ki\u1ec7n client g\u1eedi l\xean."]}),"\n"]})}),"\n",(0,c.jsx)(n.h2,{id:"wsresponset",children:(0,c.jsx)(n.code,{children:"WsResponse<T>"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Trong ",(0,c.jsx)(n.strong,{children:"NestJS WebSocket"})," , ",(0,c.jsx)(n.code,{children:"WsResponse"})," l\xe0 m\u1ed9t ",(0,c.jsx)(n.strong,{children:"wrapper object"})," d\xf9ng \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a ",(0,c.jsx)(n.strong,{children:"ph\u1ea3n h\u1ed3i c\xf3 c\u1ea5u tr\xfac"})," trong c\xe1c ",(0,c.jsx)(n.code,{children:"@SubscribeMessage()"})," handler."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["\ud83d\udd0d \xdd ngh\u0129a c\u1ee7a ",(0,c.jsx)(n.code,{children:"WsResponse"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"WsResponse<T>"})," l\xe0 m\u1ed9t ",(0,c.jsx)(n.strong,{children:"interface"})," v\u1edbi c\u1ea5u tr\xfac:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ts",children:"interface WsResponse<T = any> {\n  event: string;\n  data: T;\n}\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"N\xf3 cho ph\xe9p ta tr\u1ea3 v\u1ec1:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"event"}),": t\xean s\u1ef1 ki\u1ec7n ph\xeda client s\u1ebd nh\u1eadn"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"data"}),": d\u1eef li\u1ec7u ta mu\u1ed1n g\u1eedi l\u1ea1i"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["\ud83d\udca1 Khi n\xe0o n\xean d\xf9ng ",(0,c.jsx)(n.code,{children:"WsResponse"}),":"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"T\xecnh hu\u1ed1ng"}),(0,c.jsxs)(n.th,{children:["C\xf3 n\xean d\xf9ng ",(0,c.jsx)(n.code,{children:"WsResponse"}),"?"]})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:["Ta mu\u1ed1n g\u1eedi ",(0,c.jsx)(n.strong,{children:"ph\u1ea3n h\u1ed3i c\xf3 c\u1ea5u tr\xfac"})," v\u1ec1 m\u1ed9t event c\u1ee5 th\u1ec3"]}),(0,c.jsx)(n.td,{children:"\u2705 N\xean"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:["Ta ch\u1ec9 d\xf9ng ",(0,c.jsx)(n.code,{children:"this.server.emit()"}),"\u0111\u1ec3 b\u1eafn d\u1eef li\u1ec7u"]}),(0,c.jsx)(n.td,{children:"\u274c Kh\xf4ng c\u1ea7n"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:["Ta d\xf9ng ",(0,c.jsx)(n.code,{children:"client.emit()"}),"th\u1ee7 c\xf4ng trong handler"]}),(0,c.jsxs)(n.td,{children:["\u274c Kh\xf4ng c\u1ea7n d\xf9ng ",(0,c.jsx)(n.code,{children:"WsResponse"})]})]})]})]}),"\n",(0,c.jsxs)(n.h2,{id:"s\u1ef1-kh\xe1c-bi\u1ec7t-gi\u1eefa-thisserveremit--thisservertoemit-v\xe0-clientemit",children:["S\u1ef1 kh\xe1c bi\u1ec7t gi\u1eefa ",(0,c.jsx)(n.code,{children:"this.server.emit(...)"})," , ",(0,c.jsx)(n.code,{children:"this.server.to().emit()"})," v\xe0 ",(0,c.jsx)(n.code,{children:"client.emit(...)"})]}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"C\xe2u l\u1ec7nh"}),(0,c.jsx)(n.th,{children:"G\u1eedi \u0111\u1ebfn ai"}),(0,c.jsx)(n.th,{children:"M\xf4 t\u1ea3"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"client.emit(...)"})}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.strong,{children:"Ch\u1ec9 g\u1eedi \u0111\u1ebfn ch\xednh client"})," \u0111ang g\u1ecdi s\u1ef1 ki\u1ec7n ",(0,c.jsx)(n.code,{children:"markSeenMessage"}),"."]}),(0,c.jsxs)(n.td,{children:["\u0110\xe2y l\xe0 c\xe1ch g\u1eedi ph\u1ea3n h\u1ed3i ri\xeang bi\u1ec7t cho m\u1ed9t client c\u1ee5 th\u1ec3 (t\u1ee9c l\xe0 m\u1ed9t ",(0,c.jsx)(n.strong,{children:"socket connection duy nh\u1ea5t"}),")."]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"this.server.emit(...)"})}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.strong,{children:"Broadcast to\xe0n b\u1ed9"})," m\u1ecdi client \u0111ang k\u1ebft n\u1ed1i trong namespace."]}),(0,c.jsxs)(n.td,{children:["T\u1ee9c l\xe0 ",(0,c.jsx)(n.strong,{children:"t\u1ea5t c\u1ea3"})," ng\u01b0\u1eddi d\xf9ng \u0111ang k\u1ebft n\u1ed1i v\xe0o namespace\u0111\u1ec1u nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 ki\u1ec7n."]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"this.server.to([...clientsSocketId]).emit(...)"})}),(0,c.jsx)(n.td,{children:"G\u1eedi \u0111\u1ebfn c\xe1c client \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh th\xf4ng qua socket ID c\u1ee7a ch\xfang"}),(0,c.jsx)(n.td,{children:"C\xe1c client \u0111ang k\u1ebft n\u1ed1i v\u1edbi namespace m\xe0 \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh s\u1ebd nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 ki\u1ec7n"})]})]})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["V\xed d\u1ee5 th\u1ef1c t\u1ebf: Gi\u1ea3 s\u1eed 5 client \u0111ang k\u1ebft n\u1ed1i v\xe0o namespace ",(0,c.jsx)(n.code,{children:"/chat"}),":","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"clientA"})," (g\u1eedi s\u1ef1 ki\u1ec7n ",(0,c.jsx)(n.code,{children:"USER_MARK_SEEN_MESSAGE"}),")"]}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"clientB"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"clientC"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"clientD"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"clientE"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ts",children:'client.emit("test", { userId }); // Ch\u1ec9 A nh\u1eadn \u0111\u01b0\u1ee3c\nthis.server.emit("test", { userId }); // C\u1ea3 A, B, C, D, E \u0111\u1ec1u nh\u1eadn \u0111\u01b0\u1ee3c\nthis.server.to([clientIdB, clientIdE]); // Ch\u1ec9 B, E nh\u1eadn \u0111\u01b0\u1ee3c\n'})})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var t=s(6540);const c={},i=t.createContext(c);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);