"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[59],{8621:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>a,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var o=t(4848),s=t(8453);const r={sidebar_position:5},i="Exception Filters",c={id:"nestjs-fundamentals/exception-filters",title:"Exception Filters",description:"- NestJS cung c\u1ea5p cho ta m\u1ed9t l\u1edbp g\u1ecdi l\xe0 HttpException v\xe0 c\xe1c l\u1edbp con k\u1ebf th\u1eeba t\u1eeb n\xf3 \u0111\u1ec3 x\u1eed l\xfd exception \u0111\u01b0\u1ee3c throw ra t\u1eeb \u1ee9ng d\u1ee5ng.",source:"@site/docs/nestjs-fundamentals/exception-filters.md",sourceDirName:"nestjs-fundamentals",slug:"/nestjs-fundamentals/exception-filters",permalink:"/nestjs/nestjs-fundamentals/exception-filters",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Pipes",permalink:"/nestjs/nestjs-fundamentals/pipes"},next:{title:"Execution context",permalink:"/nestjs/nestjs-fundamentals/execution-context"}},l={},p=[{value:"V\xed d\u1ee5 khi throw m\u1ed9t exception",id:"v\xed-d\u1ee5-khi-throw-m\u1ed9t-exception",level:2},{value:"Exception filters",id:"exception-filters-1",level:2},{value:"V\xed d\u1ee5",id:"v\xed-d\u1ee5",level:3},{value:"Catch All Exception",id:"catch-all-exception",level:2},{value:"V\xed d\u1ee5 v\u1ec1 c\xe1c c\u1ea5p \u0111\u1ed9 s\u1eed d\u1ee5ng Exception Filters",id:"v\xed-d\u1ee5-v\u1ec1-c\xe1c-c\u1ea5p-\u0111\u1ed9-s\u1eed-d\u1ee5ng-exception-filters",level:2},{value:"C\u1ea5p \u0111\u1ed9 Global",id:"c\u1ea5p-\u0111\u1ed9-global",level:3},{value:"C\u1ea5p \u0111\u1ed9 controller",id:"c\u1ea5p-\u0111\u1ed9-controller",level:3},{value:"C\u1ea5p \u0111\u1ed9 method",id:"c\u1ea5p-\u0111\u1ed9-method",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"exception-filters",children:"Exception Filters"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["NestJS cung c\u1ea5p cho ta m\u1ed9t l\u1edbp g\u1ecdi l\xe0 ",(0,o.jsx)(n.strong,{children:"HttpException"})," v\xe0 c\xe1c l\u1edbp con k\u1ebf th\u1eeba t\u1eeb n\xf3 \u0111\u1ec3 x\u1eed l\xfd exception \u0111\u01b0\u1ee3c throw ra t\u1eeb \u1ee9ng d\u1ee5ng."]}),"\n",(0,o.jsxs)(n.li,{children:["M\u1ed9t s\u1ed1 built-in exception trong NestJS:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"BadRequestException"}),"\n",(0,o.jsx)(n.li,{children:"UnauthorizedException"}),"\n",(0,o.jsx)(n.li,{children:"NotFoundException"}),"\n",(0,o.jsx)(n.li,{children:"ForbiddenException"}),"\n",(0,o.jsx)(n.li,{children:"NotAcceptableException"}),"\n",(0,o.jsx)(n.li,{children:"RequestTimeoutException"}),"\n",(0,o.jsx)(n.li,{children:"ConflictException"}),"\n",(0,o.jsx)(n.li,{children:"GoneException"}),"\n",(0,o.jsx)(n.li,{children:"HttpVersionNotSupportedException"}),"\n",(0,o.jsx)(n.li,{children:"PayloadTooLargeException"}),"\n",(0,o.jsx)(n.li,{children:"UnsupportedMediaTypeException"}),"\n",(0,o.jsx)(n.li,{children:"UnprocessableEntityException"}),"\n",(0,o.jsx)(n.li,{children:"InternalServerErrorException"}),"\n",(0,o.jsx)(n.li,{children:"NotImplementedException"}),"\n",(0,o.jsx)(n.li,{children:"ImATeapotException"}),"\n",(0,o.jsx)(n.li,{children:"MethodNotAllowedException"}),"\n",(0,o.jsx)(n.li,{children:"BadGatewayException"}),"\n",(0,o.jsx)(n.li,{children:"ServiceUnavailableException"}),"\n",(0,o.jsx)(n.li,{children:"GatewayTimeoutException"}),"\n",(0,o.jsx)(n.li,{children:"PreconditionFailedException"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"v\xed-d\u1ee5-khi-throw-m\u1ed9t-exception",children:"V\xed d\u1ee5 khi throw m\u1ed9t exception"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ta c\xf3 th\u1ec3 throw m\u1ed9t exception \u1edf h\xe0m controller, ho\u1eb7c service:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"@Post('register')\nasync register() {\n  throw new BadRequestException('Email already exists');\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Khi \u0111\xf3, l\u1ed7i tr\u1ea3 v\u1ec1 cho client s\u1ebd c\xf3 d\u1ea1ng:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Something bad happened",\n  "error": "Bad request",\n  "statusCode": 400\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["N\u1ebfu ta truy\u1ec1n v\xe0o m\u1ed9t string l\xe0m tham s\u1ed1 th\u1ee9 nh\u1ea5t th\xec theo m\u1eb7c \u0111\u1ecbnh NestJS s\u1ebd tr\u1ea3 v\u1ec1 error response bao g\u1ed3m 3 tr\u01b0\u1eddng l\xe0 ",(0,o.jsx)(n.strong,{children:"message"}),", ",(0,o.jsx)(n.strong,{children:"error"}),", ",(0,o.jsx)(n.strong,{children:"statusCode"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"N\u1ebfu ta truy\u1ec1n 1 object v\xe0o tham s\u1ed1 th\u1ee9 nh\u1ea5t th\xec NestJS s\u1ebd tr\u1ea3 v\u1ec1 error response l\xe0 object \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o n\xe0y."}),"\n",(0,o.jsx)(n.li,{children:"\u0110\u1ec3 custom response tr\u1ea3 v\u1ec1 cho client, h\xe3y xem m\u1ee5c k\u1ebf ti\u1ebfp \u1edf b\xean d\u01b0\u1edbi."}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"exception-filters-1",children:"Exception filters"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Throw exception \u27a1\ufe0f Exception filter \u27a1\ufe0f Client."}),"\n",(0,o.jsx)(n.li,{children:"Exception filter (b\u1ed9 l\u1ecdc exception) l\xe0 c\u01a1 ch\u1ebf x\u1eed l\xfd exception \u0111\u01b0\u1ee3c throw ra trong \u1ee9ng d\u1ee5ng. N\xf3 \u0111\u1ea3m nh\u1eadn nhi\u1ec7m v\u1ee5 x\u1eed l\xfd c\xe1c exception \u0111\u01b0\u1ee3c throw ra trong \u1ee9ng d\u1ee5ng. \u1ede \u0111\xe2y ta c\xf3 th\u1ec3 th\u1ef1c hi\u1ec7n vi\u1ec7c log ra l\u1ed7i, custom l\u1ea1i response l\u1ed7i tr\u1ea3 v\u1ec1 cho ng\u01b0\u1eddi d\xf9ng,..."}),"\n",(0,o.jsxs)(n.li,{children:["C\xf3 3 c\u1ea5p \u0111\u1ed9 \u0111\u1ec3 ta s\u1eed d\u1ee5ng exception filter:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"C\u1ea5p \u0111\u1ed9 global"}),"\n",(0,o.jsx)(n.li,{children:"C\u1ea5p \u0111\u1ed9 controller"}),"\n",(0,o.jsx)(n.li,{children:"C\u1ea5p \u0111\u1ed9 method"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u0110\u1ec3 t\u1ea1o m\u1ed9t custom exception filter, ta ",(0,o.jsx)(n.strong,{children:"implements ExceptionFilter"})]}),"\n"]})}),"\n",(0,o.jsx)(n.h3,{id:"v\xed-d\u1ee5",children:"V\xed d\u1ee5"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Trong v\xed d\u1ee5 sau, ta t\u1ea1o 1 custom exception filter \u0111\u1ec3 x\u1eed l\xfd nh\u1eefng ",(0,o.jsx)(n.strong,{children:"HttpException"})," v\xe0 tr\u1ea3 v\u1ec1 error response cho client bao g\u1ed3m 3 tr\u01b0\u1eddng l\xe0: ",(0,o.jsx)(n.strong,{children:"statusCode"}),", ",(0,o.jsx)(n.strong,{children:"timestamp"})," v\xe0 ",(0,o.jsx)(n.strong,{children:"path"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'//http-exception.filter.ts\nimport {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n} from "@nestjs/common";\nimport { Request, Response } from "express";\n\n@Catch(HttpException)\nexport class HttpExceptionFilter implements ExceptionFilter {\n  catch(exception: HttpException, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const request = ctx.getRequest<Request>();\n    const status = exception.getStatus();\n\n    response.status(status).json({\n      statusCode: status,\n      timestamp: new Date().toISOString(),\n      path: request.url,\n    });\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Trong v\xed d\u1ee5 tr\xean, t\u1ea5t c\u1ea3 c\xe1c exception l\xe0 ",(0,o.jsx)(n.strong,{children:"HttpException"})," ho\u1eb7c \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb ",(0,o.jsx)(n.strong,{children:"HttpExeption"})," \u0111\u1ec1u \u0111\u01b0\u1ee3c x\u1eed l\xfd b\u1edfi ",(0,o.jsx)(n.strong,{children:"HttpExceptionFilter"}),". N\u1ebfu ta mu\u1ed1n t\u1ea1o exception filter \u0111\u1ec3 ch\u1ec9 x\u1eed l\xfd m\u1ed9t exception c\u1ee5 th\u1ec3 n\xe0o \u0111\xf3, h\xe3y truy\u1ec1n exception \u0111\xf3 v\xe0o ",(0,o.jsx)(n.strong,{children:"@Catch()"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["V\xed d\u1ee5 exception filter d\u01b0\u1edbi \u0111\xe2y ch\u1ec9 x\u1eed l\xfd cho ",(0,o.jsx)(n.strong,{children:"UnauthorizedException"}),":"]}),"\n"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'//http-exception.filter.ts\nimport {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  UnauthorizedException,\n} from "@nestjs/common";\nimport { Request, Response } from "express";\n\n@Catch(UnauthorizedException)\nexport class UnauthorizedExceptionFilter implements ExceptionFilter {\n  catch(exception: UnauthorizedException, host: ArgumentsHost) {\n    /* Logic of the exception filter */\n  }\n}\n'})})]}),"\n",(0,o.jsx)(n.h2,{id:"catch-all-exception",children:"Catch All Exception"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Trong nhi\u1ec1u tr\u01b0\u1eddng h\u1ee3p, c\xf3 nh\u1eefng exception \u0111\u01b0\u1ee3c throw ra kh\xf4ng thu\u1ed9c ho\u1eb7c kh\xf4ng \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb ",(0,o.jsx)(n.strong,{children:"HttpException"})," c\u1ee7a NestJS, v\xed d\u1ee5 nh\u01b0 exception \u0111\u01b0\u1ee3c throw ra t\u1eeb ",(0,o.jsx)(n.strong,{children:"Error"}),". Do \u0111\xf3, ta ph\u1ea3i b\u1eaft t\u1ea5t c\u1ea3 c\xe1c exception n\xe0y, n\u1ebfu kh\xf4ng, \u1ee9ng d\u1ee5ng s\u1ebd b\u1ecb crash."]}),"\n",(0,o.jsxs)(n.li,{children:["\u0110\u1ec3 b\u1eaft t\u1ea5t c\u1ea3 c\xe1c exception nh\u01b0 v\u1eady, ta kh\xf4ng truy\u1ec1n g\xec v\xe0o ",(0,o.jsx)(n.strong,{children:"@Catch()"})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpException,\n  HttpStatus,\n} from "@nestjs/common";\nimport { Response } from "express";\n\nimport { ExceptionResponse } from "src/common/dto/ExceptionResponse.dto";\n\n@Catch()\nexport class AllExceptionsFilter implements ExceptionFilter {\n  catch(exception: any, host: ArgumentsHost): void {\n    /* Logic of AllExceptionsFilter */\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"v\xed-d\u1ee5-v\u1ec1-c\xe1c-c\u1ea5p-\u0111\u1ed9-s\u1eed-d\u1ee5ng-exception-filters",children:"V\xed d\u1ee5 v\u1ec1 c\xe1c c\u1ea5p \u0111\u1ed9 s\u1eed d\u1ee5ng Exception Filters"}),"\n",(0,o.jsx)(n.h3,{id:"c\u1ea5p-\u0111\u1ed9-global",children:"C\u1ea5p \u0111\u1ed9 Global"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import { NestFactory } from "@nestjs/core";\n\nimport { AppModule } from "./app.module";\nimport { AllExceptionsFilter } from "src/common/filters/request-validation-exception.filter";\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.useGlobalFilters(new AllExceptionsFilter());\n  await app.listen(3000);\n}\nbootstrap();\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ho\u1eb7c c\u1ea5u h\xecnh global trong AppModule:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"@Module({\n  controllers: [],\n  providers: [\n    {\n      provide: APP_FILTER,\n      useClass: AllExceptionsFilter,\n    },\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"c\u1ea5p-\u0111\u1ed9-controller",children:"C\u1ea5p \u0111\u1ed9 controller"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import { Body, Controller, Get, Post, UseFilters } from "@nestjs/common";\n\nimport { AllExceptionsFilter } from "src/common/filters/request-validation-exception.filter";\nimport { CustomersService } from "src/modules/customers/customers.service";\nimport CreateCustomerDto from "src/modules/customers/dto/create-customer.dto";\n\n@Controller("customers")\n@UseFilters(AllExceptionsFilter)\nexport class CustomersController {\n  constructor(private customerService: CustomersService) {}\n\n  @Post("/create")\n  createCustomer(\n    @Body()\n    body: CreateCustomerDto\n  ) {\n    const createdCustomer = this.customerService.create(body);\n    return createdCustomer;\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"c\u1ea5p-\u0111\u1ed9-method",children:"C\u1ea5p \u0111\u1ed9 method"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import { Body, Controller, Get, Post, UseFilters } from "@nestjs/common";\n\nimport { AllExceptionsFilter } from "src/common/filters/request-validation-exception.filter";\nimport { CustomersService } from "src/modules/customers/customers.service";\nimport CreateCustomerDto from "src/modules/customers/dto/create-customer.dto";\n\n@Controller("customers")\nexport class CustomersController {\n  constructor(private customerService: CustomersService) {}\n\n  @UseFilters(AllExceptionsFilter)\n  @Post("/create")\n  createCustomer(\n    @Body()\n    body: CreateCustomerDto\n  ) {\n    const createdCustomer = this.customerService.create(body);\n    return createdCustomer;\n  }\n}\n'})})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);